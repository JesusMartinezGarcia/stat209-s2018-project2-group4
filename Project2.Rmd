---
title: "Project 2"
author: "Camille Cavicchio, Alain Perez, Jesus Martinez, Gailyn Gabriel"
date: "3/27/2018"
output:
  html_document: default
  pdf_document: default
---




```{r, warning=FALSE, message= FALSE, echo=FALSE}     
#Loading all libraries and csvs

library(tidyverse)
library(RColorBrewer)
library(ggplot2)
#library(ggthemes)
GDP<-read_csv("GDPpercapita.csv")
hivprev<-read_csv("hivprevalence.csv")
tb<- read.csv("indicator_estimated incidence infectious tb per 100000.csv") 
```



```{r echo=FALSE, message=FALSE, warning=FALSE, results="hide"}
#Converting our data into a tidy format with the usage of gather, filter, mutate, parse, and left join.

tb<-tb%>%
  gather(key=Year,
         value=InfectedTB,
         X1990:X2007)
tb<-tb%>%
  mutate(
    Year=parse_number(Year),
    InfectedTB=InfectedTB/1000
  )

GDP<-GDP%>%gather(key="year", value="gdp", -1) %>% filter(gdp != 0) %>% filter(year>1989) %>% filter(year<2008)%>%group_by(Country)%>%rename(Year="year") %>%mutate(Year=parse_number(Year))

GDP_tb<-left_join(tb,GDP)

hivprev<-hivprev%>%
  gather(key=Year,
         value=percent_infectedHIV,
         `1979`:`2011`)%>%
  filter(Year>1989 & Year<2008)%>%
  mutate(
    Year=parse_number(Year), percent_infectedHIV=parse_number(percent_infectedHIV)
  )%>%rename(Country="country")


combined_data<-left_join(GDP_tb,hivprev)

combined_data<-combined_data [-c(2)]
combined_data<-filter(combined_data,!is.na(gdp), !is.na(percent_infectedHIV))
#View(combined_data)


```

```{r echo=FALSE, message=FALSE, warning=FALSE, results="hide"}
#Here is our combined data set

#Here is our comided data set
combined_data<-left_join(GDP_tb,hivprev)

combined_data<-combined_data%>%select(-starts_with("X"))

combined_data<-filter(combined_data,!is.na(gdp), !is.na(percent_infectedHIV))

combined_data%>%group_by(Country)%>%summarise(num_countries=n_distinct(Country))
#136 countries in the dataset

combined_data%>% arrange(desc(percent_infectedHIV))

combined_data %>% arrange(desc(InfectedTB))


```

------------------------------------------------------------------------------------------------------------------------------------
##GDP's impact on HIV percentages
```{r echo=FALSE, message=FALSE, warning=FALSE, results="hide"}
#Calcualting the average GDP of each country
average_GDP <- combined_data %>% group_by(Country) %>% summarize(average_GDP = mean(gdp))
HIV_GDP_data<-combined_data %>% right_join(average_GDP, by="Country")
#View(HIV_GDP_data) #Key average GDPs: 18288.450, 1000
```

```{r Graph function, echo=FALSE, message=FALSE, warning=FALSE, results="hide"}
#Where low_GDP is the lower bound of average GDP of each country
#Where high_GDP is the upper bound of average GDP of each country
#Where type is the type of graph you want to display (geom_point, geom_line)
#Where Fsize is the size of the line, point you want to display
#Where title is the title of the graph



graph_function <-function(data,low_GDP, high_GDP, graph_type, Fsize, title, exclude= "Anatartica")
{data1 <- data%>% filter(low_GDP< average_GDP & average_GDP < high_GDP & Country != exclude)

#Building my own theme to style the text in the graph
mynamestheme <- theme(plot.title = element_text(family = "Courier", face = "bold", size = (15)), 
                 legend.title = element_text(colour = "black",  face = "bold.italic", family = "Courier"), 
                 legend.text = element_text(face = "italic", colour="black",family = "Courier"), 
                  axis.title = element_text(family = "Courier", size = (10), colour = "black"),
                  axis.text = element_text(family = "Courier", colour = "black", size = (10)))

HIV_GDP_FPlot<- ggplot(data1, aes(x = Year)) +
                graph_type(size=Fsize, aes(y= percent_infectedHIV, color=Country))+
                #Setting up the labels in the axis
                labs(x = "Year", y = "HIV % in Population", colour = "Key")+    
                #Setting up the labels on the title
                ggtitle( title )+
                #Setting up a theme
                theme_classic()+
                mynamestheme
HIV_GDP_FPlot
}
```

An interesting pattern emerges looking at the percentages of HIV across a variety of countries when grouped by the average GDP per capita from 1990 to 2007. Countries with low GDP per capita in generally have a high percent of people with HIV in their respective population. Across time theses percentages do not stay constant, they fluctuate from year to year. This fluctuation could indicate that those infected with HIV are dying rapidly and more people are getting infected due to the lack of available contraceptives; this would make sense for a country with low GDP per capita as accessibility to medical treatment may be rare and contraceptives are seen as a luxury good. An interesting trend found in central and Sub-Saharan Africa who have low GDP per capita is that HIV percent peak and then a decrease during the mid 1990s. Additional readings confirm that an epidemic hit that region of Africa which was then followed by large combating efforts and treatment provided by the United Nations and the Blue Cross. 

 [http://www.blackhistorymonth.org.uk/article/section/real-stories/the-history-of-aids-in-africa/]


```{r echo=FALSE, message=FALSE, warning=FALSE}
graph_function(HIV_GDP_data, 0, 175, geom_point, 2.5, "HIV % in Low GDP Per Capita Countries")
```
The limits of grouping countries by GDP per capita is that location may also provide a clue to the presence of HIV in populations; we note that a lot of countries with low GDP per capita happen to be in Africa. Nevertheless, GDP per capita does provide a backdrop for comparison between "rich countries" and "poor countries." A similar analysis of the top six countries with high GDP per capita shows that the HIV percentages in these countries is dramatically smaller, ranging less than 1% of the population. HIV percentages also do not tend to fluctuate but remain constant. High GDP may indicate better access to medical facilities and contraceptives. 


```{r  echo=FALSE, message=FALSE, warning=FALSE}
graph_function(HIV_GDP_data,29000, 50000, geom_step, 2.5, "HIV % in High GDP Per Capita Countires", exclude= "Qatar")
```


